<!-- templates/payment.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Payment - {{ movie }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='payment.css') }}">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body class="payment-page">
    <div class="payment-container">
        <h2>Payment for {{ movie }}</h2>
        <p><strong>Selected Seats:</strong> {{ seats }}</p>
        <p><strong>Total Amount:</strong> â‚¹{{ total }}</p>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <form action="{{ url_for('process_payment') }}" method="POST" id="paymentForm">
            <input type="hidden" name="movie" value="{{ movie }}">
            <input type="hidden" name="seats" value="{{ seats }}">
            <input type="hidden" name="total" value="{{ total }}">

            <label>Select Payment Method:</label>
            <select name="payment_method" id="paymentMethodSelect" required onchange="showPaymentDetails()">
                <option value="">--Select--</option>
                <option value="UPI">UPI</option>
                <option value="Credit Card">Credit Card</option>
                <option value="Debit Card">Debit Card</option>
                <option value="Netbanking">Netbanking</option>
                <option value="PayPal">PayPal</option>
                <option value="Google Pay">Google Pay</option>
            </select>
            
            <!-- UPI Payment Details -->
            <div id="upiDetails" class="payment-details" style="display:none;">
                <label for="upiId">UPI ID:</label>
                <input type="text" id="upiId" name="upi_id" placeholder="username@upi" pattern="[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+" title="Please enter a valid UPI ID (e.g., username@upi)" required>
                <p class="form-hint">Enter your UPI ID in the format: username@bankname</p>
            </div>
            
            <!-- Credit Card Payment Details -->
            <div id="creditCardDetails" class="payment-details" style="display:none;">
                <label for="cardNumber">Card Number:</label>
                <input type="text" id="cardNumber" name="card_number" placeholder="XXXX XXXX XXXX XXXX" pattern="[0-9]{16}" title="Please enter a valid 16-digit card number without spaces" required>
                
                <div class="card-info">
                    <div>
                        <label for="expiryDate">Expiry Date:</label>
                        <input type="text" id="expiryDate" name="expiry_date" placeholder="MM/YY" pattern="(0[1-9]|1[0-2])\/([0-9]{2})" title="Please enter a valid expiry date in MM/YY format" required>
                    </div>
                    <div>
                        <label for="cvv">CVV:</label>
                        <input type="password" id="cvv" name="cvv" placeholder="XXX" pattern="[0-9]{3,4}" title="Please enter a valid 3 or 4 digit CVV" required>
                    </div>
                </div>
                
                <label for="nameOnCard">Name on Card:</label>
                <input type="text" id="nameOnCard" name="name_on_card" placeholder="John Doe" required>
                <p class="form-hint">All card information is encrypted and securely processed</p>
            </div>
            
            <!-- Debit Card Payment Details -->
            <div id="debitCardDetails" class="payment-details" style="display:none;">
                <label for="debitCardNumber">Card Number:</label>
                <input type="text" id="debitCardNumber" name="debit_card_number" placeholder="XXXX XXXX XXXX XXXX" pattern="[0-9]{16}" title="Please enter a valid 16-digit card number without spaces" required>
                
                <div class="card-info">
                    <div>
                        <label for="debitExpiryDate">Expiry Date:</label>
                        <input type="text" id="debitExpiryDate" name="debit_expiry_date" placeholder="MM/YY" pattern="(0[1-9]|1[0-2])\/([0-9]{2})" title="Please enter a valid expiry date in MM/YY format" required>
                    </div>
                    <div>
                        <label for="debitCvv">CVV:</label>
                        <input type="password" id="debitCvv" name="debit_cvv" placeholder="XXX" pattern="[0-9]{3,4}" title="Please enter a valid 3 or 4 digit CVV" required>
                    </div>
                </div>
                
                <label for="debitNameOnCard">Name on Card:</label>
                <input type="text" id="debitNameOnCard" name="debit_name_on_card" placeholder="John Doe" required>
                <p class="form-hint">All card information is encrypted and securely processed</p>
            </div>
            
            <!-- Netbanking Payment Details -->
            <div id="netbankingDetails" class="payment-details" style="display:none;">
                <label for="bankSelect">Select Bank:</label>
                <select id="bankSelect" name="bank_name" required>
                    <option value="">--Select Bank--</option>
                    <option value="SBI">State Bank of India</option>
                    <option value="HDFC">HDFC Bank</option>
                    <option value="ICICI">ICICI Bank</option>
                    <option value="Axis">Axis Bank</option>
                    <option value="PNB">Punjab National Bank</option>
                </select>
                <p class="form-hint">You will be redirected to your bank's secure login page</p>
            </div>
            
            <!-- PayPal Payment Details -->
            <div id="paypalDetails" class="payment-details" style="display:none;">
                <label for="paypalEmail">PayPal Email:</label>
                <input type="email" id="paypalEmail" name="paypal_email" placeholder="email@example.com" required>
                <p class="form-hint">You will be redirected to PayPal to complete your payment</p>
            </div>
            
            <!-- Google Pay Payment Details -->
            <div id="googlePayDetails" class="payment-details" style="display:none;">
                <label for="googlePayNumber">Phone Number:</label>
                <input type="tel" id="googlePayNumber" name="google_pay_number" placeholder="+91 XXXXXXXXXX" pattern="[+][0-9]{2,3}\s[0-9]{10}" title="Please enter a valid phone number with country code (e.g., +91 9876543210)" required>
                <p class="form-hint">Enter the phone number linked to your Google Pay account</p>
            </div>

            <button type="submit">Pay Now</button>
        </form>
    </div>
    
    <script>
        function showPaymentDetails() {
            // Hide all payment details sections first
            const detailSections = document.querySelectorAll('.payment-details');
            detailSections.forEach(section => {
                section.style.display = 'none';
                
                // Disable required attribute for hidden fields
                const inputs = section.querySelectorAll('input, select');
                inputs.forEach(input => {
                    input.required = false;
                });
            });
            
            // Get selected payment method
            const selectedMethod = document.getElementById('paymentMethodSelect').value;
            
            // Show the appropriate section based on selection
            let activeSection = null;
            
            if (selectedMethod === 'UPI') {
                activeSection = document.getElementById('upiDetails');
            } else if (selectedMethod === 'Credit Card') {
                activeSection = document.getElementById('creditCardDetails');
            } else if (selectedMethod === 'Debit Card') {
                activeSection = document.getElementById('debitCardDetails');
            } else if (selectedMethod === 'Netbanking') {
                activeSection = document.getElementById('netbankingDetails');
            } else if (selectedMethod === 'PayPal') {
                activeSection = document.getElementById('paypalDetails');
            } else if (selectedMethod === 'Google Pay') {
                activeSection = document.getElementById('googlePayDetails');
            }
            
            if (activeSection) {
                activeSection.style.display = 'block';
                
                // Enable required attribute for visible fields
                const inputs = activeSection.querySelectorAll('input, select');
                inputs.forEach(input => {
                    if (input.hasAttribute('required-if-visible')) {
                        input.required = true;
                    }
                });
            }
        }
        
        // Form validation
        document.getElementById('paymentForm').addEventListener('submit', function(event) {
            const paymentMethod = document.getElementById('paymentMethodSelect').value;
            
            if (!paymentMethod) {
                alert('Please select a payment method');
                event.preventDefault();
                return false;
            }
            
            // Validate UPI ID
            if (paymentMethod === 'UPI') {
                const upiId = document.getElementById('upiId').value;
                const upiPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+$/;
                
                if (!upiPattern.test(upiId)) {
                    alert('Please enter a valid UPI ID (e.g., username@upi)');
                    event.preventDefault();
                    return false;
                }
            }
            
            // Validate Credit Card
            if (paymentMethod === 'Credit Card') {
                const cardNumber = document.getElementById('cardNumber').value;
                const expiryDate = document.getElementById('expiryDate').value;
                const cvv = document.getElementById('cvv').value;
                
                if (!/^[0-9]{16}$/.test(cardNumber)) {
                    alert('Please enter a valid 16-digit card number');
                    event.preventDefault();
                    return false;
                }
                
                if (!/^(0[1-9]|1[0-2])\/([0-9]{2})$/.test(expiryDate)) {
                    alert('Please enter a valid expiry date in MM/YY format');
                    event.preventDefault();
                    return false;
                }
                
                if (!/^[0-9]{3,4}$/.test(cvv)) {
                    alert('Please enter a valid CVV');
                    event.preventDefault();
                    return false;
                }
            }
            
            return true;
        });
        
        // Initialize on page load
        window.onload = function() {
            showPaymentDetails();
        };
    </script>
</body>
</html>